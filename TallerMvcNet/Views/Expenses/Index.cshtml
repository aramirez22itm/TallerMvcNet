@model List<TallerMvcNet.Models.Expense>

<div class="container mt-4">
    <h2 class="text-center mb-4">💸 Gestor de Gastos</h2>

    <div class="card shadow mb-4">
        <div class="card-header bg-dark text-white">Nuevo Gasto</div>
        <div class="card-body">
            <form asp-action="Add" method="post" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Descripción</label>
                    <input name="Description" type="text" class="form-control" placeholder="Ej: Taxis..." required />
                </div>
                <div class="col-md-2">
                    <label class="form-label">Monto</label>
                    <input name="Amount" type="number" step="0.01" class="form-control" placeholder="0.00" required />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Categoría</label>
                    <select name="Category" class="form-select">
                        <option value="Comida">Comida</option>
                        <option value="Transporte">Transporte</option>
                        <option value="Servicios">Servicios</option>
                        <option value="Ocio">Ocio</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Fecha</label>
                    <input name="Date" type="date" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary w-100">Registrar Gasto</button>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h4>📋 Últimos Movimientos</h4>
            <div class="list-group">
                @if (Model.Count == 0)
                {
                    <p class="text-muted">No hay gastos registrados.</p>
                }

                @foreach (var item in Model)
                {
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>@item.Description</strong>
                            <br>
                            <small class="text-muted">@item.Date.ToShortDateString() • @item.Category</small>
                        </div>
                        <span class="badge bg-danger rounded-pill" style="font-size: 1em;">
                            -$@item.Amount
                        </span>
                    </div>
                }
            </div>
        </div>

        <div class="col-md-6">
            <h4>📊 Resumen por Mes</h4>

            @{
                var resumen = ViewBag.Summary as List<TallerMvcNet.Models.ExpenseSummary>;
            }

            @if (resumen == null || resumen.Count == 0)
            {
                <div class="alert alert-info">Registra gastos para ver el resumen.</div>
            }
            else
            {
                @foreach (var mes in resumen)
                {
                    <div class="card mb-3 border-info">
                        <div class="card-header bg-info text-white d-flex justify-content-between">
                            <span>📅 @mes.MonthYear</span>
                            <strong>Total: $@mes.Total</strong>
                        </div>
                        <ul class="list-group list-group-flush">
                            @foreach (var cat in mes.CategoryTotals)
                            {
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>@cat.Key</span>
                                    <span class="fw-bold">$@cat.Value</span>
                                </li>
                            }
                        </ul>
                    </div>
                }
            }
        </div>
    </div>
</div>